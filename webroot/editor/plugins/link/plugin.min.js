tinymce.PluginManager.add("link",function(e){function t(){function t(){i||0!==o.text.length||this.parent().parent().find("#text")[0].value(this.value())}var n,r,i,o={},a=e.selection,s=e.dom;n=a.getNode(),r=s.getParent(n,"a[href]"),r&&a.select(r),o.text=i=a.getContent({format:"text"}),o.href=r?s.getAttrib(r,"href"):"",o.target=r?s.getAttrib(r,"target"):"","IMG"==n.nodeName&&(o.text=i=" "),e.windowManager.open({title:"Insert link",data:o,body:[{name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){i=this.value()}},{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:t,onkeyup:t},{name:"target",type:"listbox",label:"Target",values:[{text:"None",value:""},{text:"New window",value:"_blank"}]}],onSubmit:function(t){var n=t.data;return n.href?(n.text!=i?r?(e.focus(),r.innerHTML=n.text,s.setAttribs(r,{href:n.href,target:n.target}),a.select(r)):e.insertContent(s.createHTML("a",{href:n.href,target:n.target},n.text)):e.execCommand("mceInsertLink",!1,{href:n.href,target:n.target}),void 0):(e.execCommand("unlink"),void 0)}})}e.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:t,stateSelector:"a[href]"}),e.addButton("unlink",{icon:"unlink",tooltip:"Remove link(s)",cmd:"unlink",stateSelector:"a[href]"}),e.addShortcut("Ctrl+K","",t),this.showDialog=t,e.addMenuItem("link",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:t,stateSelector:"a[href]",context:"insert",prependToContext:!0})});